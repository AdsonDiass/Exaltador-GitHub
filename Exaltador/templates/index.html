<script>
    async function exaltar() {
        const user = document.getElementById("githubUser").value;
        const resultado = document.getElementById("resultado");
        const btn = document.getElementById("btn");

        if (!user) {
            resultado.innerText = "Digite um usuário do GitHub.";
            return;
        }

        // Feedback visual
        btn.disabled = true;
        btn.innerText = "Exaltando...";
        resultado.innerText = "🔄 Buscando dados do GitHub...";

        try {
            // 👉 Buscar dados do GitHub
            const perfilResponse = await fetch(`/github/${user}`);
            const perfil = await perfilResponse.json();

            if (!perfilResponse.ok) {
                resultado.innerText = "❌ Usuário não encontrado no GitHub.";
                throw new Error(perfil.error);
            }

            // 👉 Gerar texto de exaltação
            const resposta = await fetch("/exaltar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ texto: perfil.name || perfil.login })
            });

            const data = await resposta.json();

            resultado.innerHTML = `
            <div class="github-highlight">
                <div class="profile-header">
                    <img src="${perfil.avatar_url}" alt="Avatar" class="avatar" width="80" style="border-radius:50%;">
                    <div class="user-info">
                        <h2 class="username">${perfil.name || perfil.login}</h2>
                        <p class="subtitle">${perfil.bio || 'Estrela em ascensão no GitHub 🌟'}</p>
                    </div>
                </div>
                <div class="highlight-body">
                    <p>${data.resposta}</p>
                </div>
                <div class="cta-footer">
                    <a href="https://github.com/${perfil.login}" target="_blank" class="github-btn">🔗 Ver Perfil no GitHub</a>
                    <div class="stars">⭐️⭐️⭐️⭐️⭐️</div>
                </div>
            </div>
            `;
        } catch (e) {
            console.error(e);
            resultado.innerText = "Erro ao exaltar o perfil 😢";
        } finally {
            btn.disabled = false;
            btn.innerText = "Exaltar";
        }
    }
</script>
